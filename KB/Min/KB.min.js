var CreateKB=function(){function q(){function e(){function a(b){if("outerHTML"===b.attr||"outerText"===b.attr)b.target=b.target.parentElement;var a=0,a="appendChild"===b.attr&&"INPUT"===b.arguments[0].tagName?b.arguments[0]:[],d="appendChild"===b.attr&&"TEXTAREA"===b.arguments[0].tagName?b.arguments[0]:[],c=b.target.getElementsByTagName("INPUT"),d=Array.prototype.slice.call(c).concat(a).filter(function(b){return"radio"!==b.type&&"checkbox"!==b.type}).concat(Array.prototype.slice.call(b.target.getElementsByTagName("TEXTAREA")).concat(d)),
r=Array.prototype.slice.call(c).concat(a).filter(function(b){return"radio"===b.type||"checkbox"===b.type}),c=Object.getOwnPropertyNames(b.target.style);b=Array.prototype.slice.call(b.target.querySelectorAll("*")).concat("appendChild"===b.attr?[b.arguments[0]]:[]);for(a=0;a<d.length;a++)void 0===d[a].kb_onkeydown&&d[a].kb_addInputBinding();for(a=0;a<r.length;a++)void 0===r[a].kb_onmousedown&&r[a].kb_addInputBoxBinding();for(a=0;a<b.length;a++)for(d=0;d<c.length;d++)e.injectStyle(b[a],c[d],n,p)}function d(b){var a=
new q(b.target,b.arguments[0],"setAttribute"===b.attr?b.arguments[1]:"",b.target.getAttribute(b.arguments[0]),"setAttribute"===b.attr?[b.arguments[1]]:[""]);if(void 0!==h[a.attr])for(f=0;f<h[a.attr].length;f+=1)h[a.attr][f].call(a.target,a),a._stopPropogation&&b.stopPropagation(),a._preventDefault&&b.preventDefault()}function c(b){var a=new q(b.target,b.arguments[0],"setAttribute"===b.attr?b.arguments[1]:"",b.target.getAttribute(b.arguments[0]),"setAttribute"===b.attr?[b.arguments[1]]:[""]);if(void 0!==
k[a.attr])for(f=0;f<k[a.attr].length;f+=1)k[a.attr][f].call(a.target,a),a._stopPropogation&&b.stopPropagation()}var r=Object.keys(g);for(f=0;f<r.length;f++)void 0===g[r[f]].set&&e.injectPrototypes(g[r[f]].obj,n,p);e.addAttrUpdateListener("appendChild",a);e.addAttrUpdateListener("removeChild",a);e.addAttrUpdateListener("innerHTML",a);e.addAttrUpdateListener("outerHTML",a);e.addAttrUpdateListener("innerText",a);e.addAttrUpdateListener("outerText",a);e.addAttrUpdateListener("textContent",a);e.addAttrListener("setAttribute",
d);e.addAttrListener("removeAttribute",d);e.addAttrUpdateListener("setAttribute",c);e.addAttrUpdateListener("removeAttribute",c);(function(){for(var a=Object.getOwnPropertyNames(document.all[0].style),d=0;d<document.all.length;d++)for(var c=0;c<a.length;c++)e.injectStyle(document.all[d],a[c],n,p)})();(function(){for(var a=0,a=document.getElementsByTagName("INPUT"),d=Array.prototype.slice.call(a).filter(function(a){return"radio"!==a.type&&"checkbox"!==a.type}).concat(Array.prototype.slice.call(document.getElementsByTagName("TEXTAREA"))),
c=Array.prototype.slice.call(a).filter(function(a){return"radio"===a.type||"checkbox"===a.type}),a=0;a<d.length;a++)void 0===d[a].kb_onkeydown&&d[a].kb_addInputBinding();for(a=0;a<c.length;a++)void 0===c[a].kb_onmousedown&&c[a].kb_addInputBoxBinding()})()}var h={},k={},g={},f,q=function(a,d,c,e,b,f){this.stopPropagation=function(){this._stopPropogation=!0};this.preventDefault=function(){this._preventDefault=!0};this.value=c;this.oldValue=e;this.target=a;this.attr=d;this.arguments=b;this.action=f},
n=function(a,d,c,e,b){c=new q(a,d,c,e,b);if(void 0!==h["*"])a:for(f=0;f<h["*"].length;f+=1)if(h["*"][f].call(a,c),c._stopPropogation)break a;if(void 0!==h[d]&&!c._stopPropogation)a:for(f=0;f<h[d].length;f+=1)if(h[d][f].call(a,c),c._stopPropogation)break a;if(void 0!==a.kb_attrListeners&&void 0!==a.kb_attrListeners()[d]&&!c._stopPropogation)a:for(f=0;f<a.kb_attrListeners()[d].length;f+=1)if(a.kb_attrListeners()[d][f].call(a,c),c._stopPropogation)break a;return c._preventDefault?!1:!0},p=function(a,
d,c,e,b,f){c=new q(a,d,c,e,b,f);if(void 0!==k["*"])a:for(e=0;e<k["*"].length;e+=1)if(k["*"][e].call(a,c),c._stopPropogation)break a;if(void 0!==k[d])a:for(e=0;e<k[d].length;e+=1)if(k[d][e].call(a,c),c._stopPropogation)break a;if(void 0!==a.kb_attrUpdateListeners&&void 0!==a.kb_attrUpdateListeners[d])a:for(e=0;e<a.kb_attrUpdateListeners[d].length;e+=1)if(a.kb_attrUpdateListeners[d][e].call(a,c),c._stopPropogation)break a;return c._preventDefault?!1:!0};e.injectPrototypeProperty=function(a,d,c,f,b){var l=
a.prototype,m=Object.getOwnPropertyDescriptor(l,d);b=b||a.toString().split(/\s+/)[1].split("{")[0].replace("()","");void 0===l.addAttrListener&&void 0===l.kb_attrListeners&&(l.kb_attrListeners=function(){void 0===this._kb_attrListeners&&(this._kb_attrListeners={});return this._kb_attrListeners},l.addAttrListener=e.addAttrListener,l.removeAttrListener=e.removeAttrListener);void 0===l.addAttrUpdateListener&&void 0===l.kb_attrUpdateListeners&&(l.kb_attrUpdateListeners=function(){void 0===this._kb_attrUpdateListeners&&
(this._kb_attrUpdateListeners={});return this._kb_attrUpdateListeners},l.addAttrUpdateListener=e.addAttrUpdateListener,l.removeAttrUpdateListener=e.removeAttrUpdateListener);void 0===g[b]&&(g[b]={obj:a,proto:l,descriptors:{},set:void 0,update:void 0});g[b].set=c?c:g[b].set;g[b].update=f?f:g[b].update;g[b].descriptors[d]=m;void 0!==m.set&&m.configurable?Object.defineProperty(l,d,{get:m.get,set:function(a){var c=m.get.apply(this);"function"==typeof g[b].set&&g[b].set(this,d,a,c,arguments)&&m.set.apply(this,
arguments);"function"===typeof g[b].update&&g[b].update(this,d,a,c)},enumerable:!0,configurable:!0}):"function"===typeof m.value?Object.defineProperty(l,d,{value:function(){var a=null;"function"==typeof g[b].set&&g[b].set(this,d,null,null,arguments)&&(a=m.value.apply(this,arguments));"function"===typeof g[b].update&&g[b].update(this,d,null,null,arguments,a);return a},writable:!0,enumerable:!0,configurable:!0}):void 0!==m.value&&m.configurable&&Object.defineProperty(l,d,{get:function(){return m.value},
set:function(a){var c=m.value;"function"==typeof g[b].set&&g[b].set(this,d,a,c)&&(m.value=a);"function"===typeof g[b].update&&g[b].update(this,d,a,c)},enumerable:!0,configurable:!0})};e.injectPrototypes=function(a,d,c){var h=a.prototype,b=a.toString().split(/\s+/)[1].split("{")[0].replace("()",""),l=Object.getOwnPropertyNames(h),m={},k=function(a){var d=!1,c="false";if("checkbox"===this.type||"radio"===this.type)c=this.checked,d=!0;var e=d?"string"===typeof this.checked?"true"===this.checked?"on":
"off":this.checked?"on":"off":this.value;setTimeout(function(){d&&!g[b].set(this,"checked",this.checked,c)?m.checked.set.call(this,c):d&&"function"===typeof g[b].update&&g[b].update(this,"checked",this.checked,e);this.value=d?"string"===typeof this.checked?"true"===this.checked?"on":"off":this.checked?"on":"off":this.value;g[b].set(this,"value",this.value,e)?"function"===typeof g[b].update&&g[b].update(this,"value",this.value,e):m.value.set.call(this,e)}.bind(this),0)};void 0===g[b]&&(g[b]={obj:a,
proto:h,descriptors:{},set:void 0,update:void 0});g[b].set=d||n;g[b].update=c||p;-1<l.indexOf("value")&&(Object.defineProperty(h,"kb_removeInputBinding",{value:function(){this.kb_onkeydown=void 0;this.removeEventListener("keydown",k)},configurable:!0,enumerable:!0}),Object.defineProperty(h,"kb_addInputBinding",{value:function(){this.kb_onkeydown=!0;this.addEventListener("keydown",k)},configurable:!0,enumerable:!0}),Object.defineProperty(h,"kb_removeInputBoxBinding",{value:function(){this.kb_onmousedown=
void 0;this.removeEventListener("mouseup",k)},configurable:!0,enumerable:!0}),Object.defineProperty(h,"kb_addInputBoxBinding",{value:function(){this.kb_onmousedown=!0;this.addEventListener("mouseup",k)},configurable:!0,enumerable:!0}));for(f=0;f<l.length;f+=1)void 0===g[b].descriptors[l[f]]&&e.injectPrototypeProperty(a,l[f],null,null,b);return e};e.injectStyle=function(a,d,c,f){var b=Object.getOwnPropertyDescriptor(a.style,d),h=a.style;void 0===a.style.kb_bind&&(a.style.kb_bind={obj:a,proto:h,descriptors:{},
set:void 0,update:void 0});a.style.kb_bind.set=c?c:g[_injectName].set;a.style.kb_bind.update=f?f:g[_injectName].update;a.style.kb_bind.descriptors[d]=b;void 0!==b.value&&b.configurable&&Object.defineProperty(h,d,{get:function(){return b.value},set:function(c){var e=b.value;"function"==typeof a.style.kb_bind.set&&a.style.kb_bind.set(a,d,c,e)&&(b.value=c,a.style.setProperty(d.replace(/([A-Z])/g,"-$1").replace("webkit","-webkit"),c));"function"===typeof a.style.kb_bind.update&&a.style.kb_bind.update(a,
d,c,e)},enumerable:!0,configurable:!0});return e};e.injectedPrototypes=function(){return g};e.addAttrListener=function(a,d){if(this.toString()!==e.toString())return void 0===this.kb_attrListeners()[a]&&(this.kb_attrListeners()[a]=[]),"function"===typeof d&&this.kb_attrListeners()[a].push(d),this;void 0===h[a]&&(h[a]=[]);"function"===typeof d&&h[a].push(d);return e};e.addAttrUpdateListener=function(a,d){if(this.toString()!==e.toString())return void 0===this.kb_attrUpdateListeners()[a]&&(this.kb_attrUpdateListeners()[a]=
[]),"function"===typeof d&&this.kb_attrUpdateListeners()[a].push(d),this;void 0===k[a]&&(k[a]=[]);"function"===typeof d&&k[a].push(d);return e};e.getAttrListeners=function(){return h};e.getAttrUpdateListeners=function(){return k};e.removeAttrListener=function(a,d){if(this.toString()!==e.toString()){if(void 0!==this.kb_attrListeners&&void 0!==this.kb_attrListeners()[a]&&"function"===typeof d)for(var c=0;c<this.kb_attrListeners()[a].length;c+=1)this.kb_attrListeners()[a][c].toString()===d.toString()&&
this.kb_attrListeners()[a].splice(c,1);return this}if(void 0!==h[a]&&"function"===typeof d)for(c=0;c<h[a].length;c+=1)h[a][c].toString()===d.toString()&&h[a].splice(c,1);return e};e.removeAttrUpdateListener=function(a,d){if(this.toString()!==e.toString()){if(void 0!==this.kb_attrUpdateListeners&&void 0!==this.kb_attrUpdateListeners()[a]&&"function"===typeof d)for(var c=0;c<this.kb_attrUpdateListeners()[a].length;c+=1)this.kb_attrUpdateListeners()[a][c].toString()===d.toString()&&this.kb_attrUpdateListeners()[a].splice(c,
1);return this}if(void 0!==k[a]&&"function"===typeof d)for(c=0;c<k[a].length;c+=1)k[a][c].toString()===d.toString()&&k[a].splice(c,1);return e};e.injectPrototypes(HTMLInputElement,n,p);e.injectPrototypes(HTMLTextAreaElement,n,p);e.injectPrototypes(Node,n,p);e.injectPrototypes(Element,n,p);e.injectPrototypes(HTMLElement,n,p);e.injectPrototypes(Document,n,p);return e}"function"===typeof define&&define.amd?(define("KB",q),define([],function(){return q})):"object"===typeof module&&module.exports&&(module.exports=
q);return q}();
