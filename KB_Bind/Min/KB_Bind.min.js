var CreateKB_Bind=function(){function p(){function f(){var a=f.SearchAllTextNodes("{{"),b=f.SearchAllAttributes("}}");a.forEach(function(b,a){l.push(u().startBind("{{").endBind("}}"));l[l.length-1].call()});b.forEach(function(b,a){h.push(u().startBind("{{").endBind("}}").isAttr(!0));h[h.length-1].call()});v.forEach(function(b,a){q.removeAttrUpdateListener(b,r);q.addAttrUpdateListener(b,r)});f.getAllAttributeTypes().forEach(function(b,a){q.removeAttrUpdateListener(b,r);q.addAttrUpdateListener(b,r)})}
var p=function(){return function(){return function(){}}}(),w=function(){return function(){function a(b,c){b=b.replace(/\s+$/,"");c=c.replace(/\s+$/,"");b="string"===typeof b?""==b?[]:b.split(/\s+/):b;c="string"===typeof c?""==c?[]:c.split(/\s+/):c;return a.diffString(b,c)}a.convertWordArrToObj=function(b,c){return b.reduce(function(b,a,d){b[a]=void 0===b[a]?Object.defineProperty({rows:[d]},c,{value:null,writable:!0}):b[a].rows.push(d)?b[a]:Object.defineProperty({rows:[d]},c,{value:null,writable:!0});
return b},{})};a.diffString=function(b,c){var e=a.convertWordArrToObj(c,"o"),g=a.convertWordArrToObj(b,"n"),d=0;Object.keys(e).forEach(function(a){1==e[a].rows.length&&"undefined"!=typeof g[a]&&1==g[a].rows.length&&(c[e[a].rows[0]]={text:c[e[a].rows[0]],row:g[a].rows[0]},b[g[a].rows[0]]={text:b[g[a].rows[0]],row:e[a].rows[0]})});for(d=0;d<c.length-1;d+=1)null!=c[d].text&&null==c[d+1].text&&c[d].row+1<b.length&&null==b[c[d].row+1].text&&c[d+1]==b[c[d].row+1]&&(c[d+1]={text:c[d+1],row:c[d].row+1},b[c[d].row+
1]={text:b[c[d].row+1],row:d+1});for(d=c.length-1;0<d;--d)null!=c[d].text&&null==c[d-1].text&&0<c[d].row&&null==b[c[d].row-1].text&&c[d-1]==b[c[d].row-1]&&(c[d-1]={text:c[d-1],row:c[d].row-1},b[c[d].row-1]={text:b[c[d].row-1],row:d-1});return Array.prototype.concat.apply([],[b,c]).map(function(a,d){return d<b.length?{pos:d,change:"string"===typeof a&&c[d]!==a?"delete":"none",value:"string"===typeof a?a:a.text,rowObj:"object"===typeof a?a:null}:{pos:d-b.length,change:"string"===typeof a&&b[d-b.length]!==
a?"add":"none",value:"string"===typeof a?a:a.text,rowObj:"object"===typeof a?a:null}}).filter(function(a,d){return d>b.length-1&&null!==a.rowObj?"object"===typeof c[d-b.length]?b[c[d-b.length].row].text!==c[d-b.length].text:!0:d>b.length-1?c[d-b.length]!==b[d-b.length]:!0}).sort(function(b,a){return b.pos>a.pos?1:-1})};return a}}(),x=function(){function a(){function b(){var g=function(b,a,d,c,g){this.stopPropagation=function(){this._stopPropogation=!0};this.preventDefault=function(){this._preventDefault=
!0};this.value=d;this.oldValue=c;this.target=b;this.attr=a;this.arguments=g},d=function(b,d,k,m,n){k=new g(b,d,k,m,n);if(void 0!==a[d])for(m=0;m<a[d].length;m+=1){a[d][m].call(b,k);if(k._stopPropogation)break;if(k._preventDefault)return!1}return!0},n=function(b,a,d,c,n){d=new g(b,a,d,c,n);if(void 0!==e[a])for(c=0;c<e[a].length;c+=1){e[a][c].call(b,d);if(d._stopPropogation)break;if(d._preventDefault)return!1}return!0};b.inject(Node,d,n);b.inject(Element,d,n);b.inject(HTMLElement,d,n);b.inject(Document,
d,n)}var a={},e={};b.inject=function(a,d,c){var e=a.prototype;a=Object.keys(e);var f,k={},m={};for(f=0;f<a.length;f+=1)(function(a){k[a]=Object.getOwnPropertyDescriptor(e,a);void 0!==k[a].set?Object.defineProperty(e,a,{get:k[a].get,set:function(b){var g=k[a].get.apply(this);d(this,a,b,g)&&k[a].set.apply(this,arguments);"function"===typeof c&&c(this,a,b,g)},enumerable:!0,configurable:!0}):"function"===typeof k[a].value&&(m[a]=k[a].value,e[a]=function(){var b=null;d(this,a,null,null,arguments)&&(b=
m[a].apply(this,arguments));"function"===typeof c&&c(this,a,null,null,arguments,b);return b})})(a[f]);return b};b.addAttrListener=function(g,d){void 0===a[g]&&(a[g]=[]);"function"===typeof d&&a[g].push(d);return b};b.addAttrUpdateListener=function(a,d){void 0===e[a]&&(e[a]=[]);"function"===typeof d&&e[a].push(d);return b};b.removeAttrListener=function(b,d){if(void 0!==a[b]&&"function"===typeof d)for(var e=0;e<a[b].length;e+=1)a[b][e].toString()===d.toString()&&a[b].splice(e,1)};b.removeAttrUpdateListener=
function(a,b){if(void 0!==e[a]&&"function"===typeof b)for(var c=0;c<e[a].length;c+=1)e[a][c].toString()===b.toString()&&e[a].splice(c,1)};return b}"function"===typeof define&&define.amd?(define("KB",a),define([],a)):"object"===typeof module&&module.exports&&(module.exports=a);return a}(),u=function(){return function(){function a(k){b=k;e=k.textContent;d&&(e=k.value);g=a.splitBind(e);g.forEach(function(a,e){-1<a.indexOf(f)&&-1<a.indexOf(h)&&(c.push(p().bindName(a.split("|")[0].replace(f,"").replace(/\s/g,
"")).bindStartPosition((d?b.value:b.textContent).indexOf(a)).bindText(a).attributes(a.split("|")[1].replace(h).split(";").filter(function(a,b){return 0<a.length}).map(function(a,b){var c={};c[a.split("=")[0]]=a.split("=")[1];return c}))),d?b.value=c[c.length-1](b.value):b.textContent=c[c.length-1](b.textContent))});g.map(function(b,c){return-1<b.indexOf(f)&&b.indexOf(h)?{bind:a.getBindById(b.split("|")[0].replace(f,"").replace(/\s/g,"")),name:b.split("|")[0].replace(f,"").replace(/\s/g,"")}:b})}var b=
{},c=[],e="",g=[],d=!1,f="{{",h="}}",l=w();a.startBind=function(b){if(void 0===b)return f;f="string"===typeof b?b:f;return a};a.endBind=function(b){if(void 0===b)return h;h="string"===typeof b?b:h;return a};a.node=function(){return b};a.Binds=function(){return c};a.initialText=function(){return e};a.initialTextSplit=function(){return _initialTextSplit};a.isAttr=function(b){if(void 0===b)return d;d=!!b;return a};a.splitBind=function(a){return Array.prototype.concat.apply([],a.split(f).map(function(a,
b){return-1<a.indexOf(h)?(f+a).split(h).map(function(a,b){return-1<a.indexOf(f)?a+h:a}):a})).filter(function(a,b){return 0<a.length})};a.getBindById=function(a){return c.map(function(b,c){return b.bindName()!==a?null:b}).filter(function(a,b){return null!==a})};a.compareCheck=function(){l(g,d?b.value:b.textContent)};a.updateCheck=function(){var a=e;c.forEach(function(c,e){a=c(a,d?b.value:b.textContent)})};return a}}(),l=[],h=[],t={},q=x(),v="innerHTML textContent innerText outerHTML outerText appendChild removeChild".split(" "),
r=function(a){f.updateUnsynced();f();-1<v.indexOf(a.attr)?l.forEach(function(a,c){a.updateCheck()}):h.forEach(function(a,c){a.updateCheck()})};f.textBinds=function(){return l};f.attributeBinds=function(){return h};f.pipedAttributes=function(){return t};f.addPipedAttribute=function(a,b){"string"===typeof a&&"function"===typeof b&&(t[a]=b)};f.removePipedAttribute=function(a){void 0!==t[a]&&(t[a]=void 0)};f.SearchAllTextNodes=function(a){var b=!1;return Array.prototype.concat.apply([],Array.prototype.slice.call(document.all).map(function(c,
e){"BODY"===c.nodeName&&(b=!0);return b?Array.prototype.concat.apply([],Array.prototype.slice.call(c.childNodes).filter(function(b,c){return"#text"===b.nodeName&&-1<b.textContent.indexOf(a)})):null}).filter(function(a,b){return null!==a}))};f.SearchAllAttributes=function(a){var b=!1;return Array.prototype.concat.apply([],Array.prototype.slice.call(document.all).map(function(c,e){"BODY"===c.nodeName&&(b=!0);return b?Array.prototype.concat.apply([],Array.prototype.slice.call(c.attributes).filter(function(b,
c){return-1<b.value.indexOf(a)}).map(function(a,b){a.parentElement=c;return a})):null}).filter(function(a,b){return null!==a}))};f.getBindsById=function(a){return Array.prototype.concat.apply([],l.map(function(b,c){return b.getBindById(a)}).filter(function(a,c){return 0<a.length}).concat(h.map(function(b,c){return b.getBindById(a)}).filter(function(a,c){return 0<a.length})))};f.updateBindsById=function(a,b){f.getBindsById(a).forEach(function(a,e){a.value(b).call()})};f.updateUnsynced=function(){l=
l.map(function(a,b){return null===a.node().parentElement?null:a}).filter(function(a,b){return null!==a});h=h.map(function(a,b){return null===a.node().parentElement?null:a}).filter(function(a,b){return null!==a});return f};f.getAllAttributeTypes=function(){return Array.prototype.concat.apply([],h.map(function(a,b){return Array.prototype.slice.call(a.node().attributes)})).filter(function(a,b,c){return c.indexOf(a)===b})};return f}"function"===typeof define&&define.amd?(define("KB_Bind",p),define([],
p)):"object"===typeof module&&module.exports&&(module.exports=p);return p}();
